function setTags(e,t,n){function r(e,t){var n=$("<li><em>"+e+'</em><b title="删除当前标签"></b></li>');t&&n.attr("index",t),n.insertBefore(u.parent()),u.focus()}function i(e){for(var t=0,n=0;n<e.length;n++)t+=encodeURI(e[n]).length>1?2:1;return t}function o(){return s.find("li").length>n?(f.html("最多添"+n+"标签").addClass("cRed"),!1):(f.html(p).removeClass("cRed"),!0)}function a(){var e=u.val().split(" ");e.length>1&&$.each(e,function(e,n){var a=i(n);if(a>0){if(!(a>1&&t+1>a))return f.html(a>t+1?"单个标签最多"+t+"个字符，一个汉字算作两个字符":"单个标签最少2个字符，一个汉字算作两个字符").addClass("cRed"),!1;if(!o())return!1;r(n),f.html(p).removeClass("cRed"),u.val($.trim(u.val().replace(n,"")))}})}var s=e.find("ul:first"),u=e.find("input:first"),l=e.find("p:first"),c=l.find("a"),f=e.find("span:first"),p=f.html();t=t||12,n=n||5,e.delegate("b","click",function(){var e=$(this).parent(),t=e.attr("index");t&&c.eq(t-1).show(),e.remove(),u.focus()}).delegate("a","click",function(e){if(!o())return!1;e.preventDefault();var t=$(this).hide();r(t.html(),t.attr("index"))}).delegate("ul","click",function(e){"UL"==e.target.tagName&&u.focus()}),u.bind("keyup blur",a).bind("keydown",function(e){if(8==e.keyCode&&""==u.val()){var t=u.parent().prev(),n=t.find("em:first").html();if(n){var r=t.attr("index");r&&c.eq(r-1).show(),u.val(n),e.preventDefault(),t.remove()}}})}